<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading Job... - NEI Job Portal</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/responsive.css">
  
  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7778955138168695" crossorigin="anonymous"></script>
  
  <style>
    .job-detail-card { background: white; padding: 2rem; border-radius: 20px; box-shadow: var(--box-shadow); margin: 2rem 0; }
    .job-detail-card h1 { color: var(--primary-color); margin-bottom: 1.5rem; font-size: 1.8rem; }
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
    .info-item { background: var(--bg-light); padding: 1rem; border-radius: 12px; }
    .info-label { font-weight: bold; color: var(--text-dark); }
    .info-value { margin-top: 0.3rem; }
    .important-dates { background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin: 2rem 0; }
    .date-list { list-style: none; padding: 0; }
    .date-list li { padding: 0.5rem 0; border-bottom: 1px dashed #ddd; }
    .date-list li:last-child { border-bottom: none; }
    .btn-group { display: flex; flex-wrap: wrap; gap: 1rem; margin: 2rem 0; }
    .btn { padding: 1rem 2rem; border-radius: 12px; color: white; text-decoration: none; font-weight: bold; display: inline-block; transition: 0.3s; }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .btn-apply { background: #27ae60; }
    .btn-noti { background: #f39c12; }
    .btn-official { background: #34495e; }
    .btn-result { background: #9b59b6; }
    .btn-admit { background: #3498db; }
    .btn-answer { background: #e67e22; }
    .back-link { color: var(--primary-color); font-weight: bold; text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading" style="text-align:center; padding:4rem; background:white; border-radius:20px; margin:2rem 0; box-shadow:var(--box-shadow);">
      <h2>Loading full job details...</h2>
    </div>
    
    <div id="job-content" style="display:none;"></div>

    <!-- AdSense Banner -->
    <div style="text-align:center; margin:3rem 0;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-7778955138168695"
           data-ad-slot="1445867665"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  </div>

  <script>
    const { createClient } = supabase;
    const client = createClient('https://enfzymosvlrmfluwidbj.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuZnp5bW9zdmxybWZsdXdpZGJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNTU1ODYsImV4cCI6MjA3NzkzMTU4Nn0._Mf8tyGBmcVgYPDTinF-UVD-HJD3-9OB90IAPJ5Dyx4');

    const urlParams = new URLSearchParams(window.location.search);
    const jobId = urlParams.get('id');

    async function loadJob() {
      if (!jobId) {
        document.getElementById('job-content').innerHTML = '<p style="color:red; text-align:center;">Invalid Job ID</p>';
        document.getElementById('job-content').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
        return;
      }

      const { data: job, error } = await client.from('jobs').select('*').eq('id', jobId).single();

      if (error || !job) {
        document.getElementById('job-content').innerHTML = '<p style="color:red; text-align:center;">Job not found!</p>';
        document.getElementById('job-content').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
        return;
      }

      // Update page title for SEO
      document.title = `${job.title} - Last Date ${job.lastdate || 'Soon'} | NEI Job Portal`;

      // Parse dates if array
      const datesList = Array.isArray(job.dates) 
        ? job.dates.map(d => `<li><strong>${d.split(':')[0]}:</strong> ${d.split(':')[1] || d}</li>`).join('')
        : '<li>No dates available</li>';

      document.getElementById('job-content').innerHTML = `
        <div class="job-detail-card">
          <h1>${job.title}</h1>
          
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">State</div>
              <div class="info-value">${job.state === 'central-govt' ? 'Central Government' : job.state.toUpperCase()}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Last Date</div>
              <div class="info-value" style="color:#e74c3c; font-weight:bold; font-size:1.2rem;">
                ${job.lastdate || 'Not Announced'}
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Total Vacancy</div>
              <div class="info-value">${job.vacancy || 'Check Notification'}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Post Name</div>
              <div class="info-value">${job.postname || 'Various Posts'}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Salary</div>
              <div class="info-value">${job.salary || 'As per rules'}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Application Fee</div>
              <div class="info-value">${job.fee || 'See notification'}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Age Limit</div>
              <div class="info-value">${job.age || 'Check notification'}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Category</div>
              <div class="info-value">${job.category || 'N/A'}</div>
            </div>
          </div>

          <h3>Eligibility Criteria</h3>
          <p>${job.eligibility ? job.eligibility.replace(/\n/g, '<br>') : 'Check official notification'}</p>

          <div class="important-dates">
            <h3>Important Dates</h3>
            <ul class="date-list">
              ${datesList}
            </ul>
          </div>

          <h3>Important Links</h3>
          <div class="btn-group">
            ${job.apply ? `<a href="${job.apply}" target="_blank" class="btn btn-apply">Apply Online</a>` : ''}
            ${job.notification ? `<a href="${job.notification}" target="_blank" class="btn btn-noti">Download Notification</a>` : ''}
            ${job.official ? `<a href="${job.official}" target="_blank" class="btn btn-official">Official Website</a>` : ''}
            ${job.resultLink ? `<a href="${job.resultLink}" target="_blank" class="btn btn-result">Download Result</a>` : ''}
            ${job.admitCardLink ? `<a href="${job.admitCardLink}" target="_blank" class="btn btn-admit">Download Admit Card</a>` : ''}
            ${job.answerKeyLink ? `<a href="${job.answerKeyLink}" target="_blank" class="btn btn-answer">Download Answer Key</a>` : ''}
          </div>

          <div style="margin-top: 3rem; text-align: center;">
            <a href="../index.html" class="back-link">Back to All Jobs</a>
          </div>
        </div>
      `;

      document.getElementById('loading').style.display = 'none';
      document.getElementById('job-content').style.display = 'block';
    }

    loadJob();
  </script>
</body>
</html>
